<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, ~{::section}, ~{::headResources})}">
<head>
    <title>대시보드 | E-N-C 안전 시스템</title>
    <th:block th:fragment="headResources">
        <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    </th:block>
</head>
<body>
<section class="dashboard-page">
    <div class="dashboard-surface">
        <section class="dashboard-header">
            <div class="dashboard-header__meta">
                <div>
                    <p class="dashboard-header__subtitle">등록된 스트리밍 현황</p>
                    <h1 class="dashboard-header__title">실시간 영상 대시보드</h1>
                </div>
                <div class="dashboard-header__timestamp">
                    <span th:text="${#dates.format(#dates.createNow(), 'yyyy-MM-dd HH:mm:ss')} + ' KST 기준'">
                        2025-06-05 14:32:18 KST 기준
                    </span>
                    <span class="timestamp__badge">페이지 진입 시 자동 재생</span>
                </div>
            </div>
            <p class="dashboard-header__description">
                등록된 YouTube Live 스트림을 바로 재생합니다. 추후 AI 분석 및 알림 모듈이 연결되면 혼잡도, 이벤트, 스냅샷 정보도 한 화면에서 확인할 수 있습니다.
            </p>
            <div class="summary-strip">
                <article class="summary-item">
                    <h2>전체 카메라</h2>
                    <p class="summary-value"
                       th:text="${streamingCameras != null and !streamingCameras.isEmpty() ? streamingCameras.size() + '대' : '5대'}">5대</p>
                    <p class="summary-note"
                       th:text="${streamingCameras != null and !streamingCameras.isEmpty()
                                ? 'YouTube Live 등록 수'
                                : '예시: 가동 4대 · 대기 1대'}">
                        예시: 가동 4대 · 대기 1대
                    </p>
                </article>
                <article class="summary-item">
                    <h2>위험 경보</h2>
                    <p class="summary-value summary-value--danger">1건</p>
                    <p class="summary-note">예시: 심각 1 · 경미 3</p>
                </article>
                <article class="summary-item">
                    <h2>AI 분석 이벤트</h2>
                    <p class="summary-value">5건</p>
                    <p class="summary-note">예시: 최근 30분 기준</p>
                </article>
                <article class="summary-item">
                    <h2>평균 체류율</h2>
                    <p class="summary-value">0.38</p>
                    <p class="summary-note">예시: 지난 주 대비 -5%</p>
                </article>
            </div>
            <div class="rotation-status" role="status">
                <div>
                    <p class="rotation-status__title">카메라 선택 모드</p>
                    <p class="rotation-status__note">우측 목록에서 보고 싶은 카메라를 선택하세요. (예시: 자동 순환 30초)</p>
                </div>
                <div class="rotation-status__controls">
                    <span class="rotation-indicator rotation-indicator--auto">
                        <span th:text="${primaryCamera != null ? 'LIVE' : 'OFF'}">LIVE</span>
                    </span>
                    <span class="rotation-status__interval"
                          th:text="${primaryCamera != null ? primaryCamera.name() : '재생 가능한 카메라 없음'}">
                        현재 재생 중인 카메라
                    </span>
                    <div class="rotation-buttons">
                        <a class="rotation-status__action rotation-status__action--mode"
                           th:href="@{/cameras}">카메라 추가</a>
                    </div>
                </div>
            </div>
        </section>

        <div class="dashboard-grid">
            <main class="dashboard-main">
                <section class="camera-stage">
                    <header class="camera-stage__header">
                        <div>
                            <p class="camera-stage__label">카메라</p>
                            <h2>
                                <span th:if="${primaryCamera != null}"
                                      th:text="${primaryCamera.name()}">중앙로비 9층 출입구</span>
                                <span th:if="${primaryCamera == null}">재생 가능한 카메라가 없습니다</span>
                            </h2>
                            <p class="camera-stage__location">
                                <span th:if="${primaryCamera != null}"
                                      th:text="${primaryCamera.location() != null ? primaryCamera.location() : '위치 정보 미등록'}">
                                    중앙로비 동 9F
                                </span>
                                <span th:if="${primaryCamera == null}">
                                    대시보드에서 재생할 YouTube Live 카메라를 등록해 주세요.
                                </span>
                            </p>
                        </div>
                        <span class="camera-stage__status"
                              th:text="${primaryCamera != null ? 'YouTube Live' : '대기'}">YouTube Live</span>
                    </header>
                    <div class="camera-stage__feeds">
                        <figure class="camera-view camera-view--live" aria-label="실시간 스트림">
                            <div class="camera-view__display camera-view__display--media"
                                 th:if="${primaryCamera != null}">
                                <iframe th:src="${primaryCamera.embedUrl()}"
                                        title="YouTube Live"
                                        allow="autoplay; encrypted-media; picture-in-picture"
                                        allowfullscreen
                                        loading="lazy"></iframe>
                            </div>
                            <div class="camera-view__display camera-view__display--empty"
                                 th:if="${primaryCamera == null}">
                                <p>재생 가능한 YouTube Live 카메라가 없습니다.</p>
                                <a class="btn btn--ghost btn--sm" th:href="@{/cameras}">카메라 등록</a>
                            </div>
                            <figcaption th:text="${primaryCamera != null ? primaryCamera.name() + ' · 자동 재생 중' : '등록된 카메라 없음'}">
                                라이브 프레임 · 14:32:18
                            </figcaption>
                        </figure>
                        <figure class="camera-view camera-view--snapshot" aria-label="30초 스냅샷">
                            <div class="camera-view__display camera-view__display--placeholder">
                                <p>30초 스냅샷 기능은 준비 중입니다.</p>
                                <span>AI 분석 모듈과 함께 제공될 예정입니다.</span>
                            </div>
                            <figcaption>스냅샷 모듈 준비중 (예시: 14:32:00 기준)</figcaption>
                        </figure>
                    </div>
                </section>

                <article class="alerts-panel alerts-panel--wide" aria-labelledby="alerts-title">
                    <div class="alerts-panel__header">
                        <h2 id="alerts-title">최근 알림 (예시)</h2>
                        <p class="alerts-panel__summary">실제 알림 모듈 연동 시 자동 갱신됩니다.</p>
                    </div>
                    <ul class="alerts-list">
                        <li class="alerts-item alerts-item--high">
                            <time>14:31:44</time>
                            <div>
                                <p>혼잡도 1단계</p>
                                <span>밀집도 0.78 · 대기열 4열</span>
                            </div>
                        </li>
                        <li class="alerts-item alerts-item--medium">
                            <time>14:30:58</time>
                            <div>
                                <p>차량진입구 B동</p>
                                <span>차량 대기열 증가</span>
                            </div>
                        </li>
                        <li class="alerts-item alerts-item--high">
                            <time>14:28:12</time>
                            <div>
                                <p>비상문 개방</p>
                                <span>화재 센서 감지</span>
                            </div>
                        </li>
                        <li class="alerts-item alerts-item--low">
                            <time>14:27:05</time>
                            <div>
                                <p>물류창고 A동</p>
                                <span>출입 기록 누락</span>
                            </div>
                        </li>
                        <li class="alerts-item alerts-item--medium">
                            <time>14:25:41</time>
                            <div>
                                <p>주차동 2층</p>
                                <span>역주행 의심 이동</span>
                            </div>
                        </li>
                    </ul>
                </article>
            </main>
            <aside class="dashboard-sidebar">
                <section class="camera-info">
                    <div class="camera-info__group">
                        <dl class="camera-metrics">
                            <div>
                                <dt>위치</dt>
                                <dd th:text="${primaryCamera != null && primaryCamera.location() != null ? primaryCamera.location() : '중앙로비 동 9F (예시)'}">
                                    중앙로비 동 9F (예시)
                                </dd>
                            </div>
                            <div>
                                <dt>혼잡도</dt>
                                <dd>
                                    <span class="metric-value">0.78</span>
                                    <span class="metric-note">예시: 실시간 혼잡 지수</span>
                                </dd>
                            </div>
                            <div>
                                <dt>증감률</dt>
                                <dd>
                                    <span class="metric-value positive">+6%/분</span>
                                    <span class="metric-note">예시: 최근 5분 대비</span>
                                </dd>
                            </div>
                            <div>
                                <dt>관측 시간</dt>
                                <dd>
                                    <span class="metric-value">00:04:12</span>
                                    <span class="metric-note">예시: 스트림 유지 시간</span>
                                </dd>
                            </div>
                            <div>
                                <dt>원본 주소</dt>
                                <dd>
                                    <a th:if="${primaryCamera != null}"
                                       th:href="${primaryCamera.streamUrl()}"
                                       target="_blank" rel="noopener" class="camera-link">
                                        원본 보기
                                    </a>
                                    <span th:if="${primaryCamera == null}">샘플 스트림</span>
                                </dd>
                            </div>
                        </dl>
                        <div class="camera-tags">
                            <span class="chip chip--warning">혼잡 시간 (예시)</span>
                            <span class="chip chip--ai">AI 경보 12건 (예시)</span>
                        </div>
                    </div>
                    <div class="camera-info__group">
                        <p class="camera-info__message">
                            스트리밍은 즉시 재생되며, 혼잡도·이벤트 분석은 추후 업데이트 예정입니다. 아래는 표시될 데이터 형태 예시입니다.
                        </p>
                        <div class="camera-info__timeline">
                            <h3>분석 타임라인 (예시)</h3>
                            <ol>
                                <li><time>14:32:00</time> 혼잡도 0.78 · 대기열 4열</li>
                                <li><time>14:31:30</time> 보행 속도 20% 감소</li>
                                <li><time>14:31:00</time> 이동 가속도 감소</li>
                            </ol>
                        </div>
                    </div>
                    <div class="camera-list-panel">
                        <h2 class="camera-list-panel__title">전체 카메라</h2>
                        <ul class="camera-list">
                            <li class="camera-list__item camera-list__item--empty"
                                th:if="${#lists.isEmpty(streamingCameras)}">
                                등록된 YouTube Live 카메라가 없습니다.
                            </li>
                            <li th:each="camera : ${streamingCameras}"
                                class="camera-list__item"
                                th:classappend="${primaryCamera != null and primaryCamera.id() == camera.id()} ? ' camera-list__item--active' : ''"
                                th:attr="data-camera-id=${camera.id()}">
                                <a class="camera-list__link"
                                   th:href="@{/(cameraId=${camera.id()})}">
                                    <div class="camera-list__meta">
                                        <span class="camera-list__name" th:text="${camera.name()}">본관 로비</span>
                                        <span class="camera-list__location"
                                              th:text="${camera.location() != null ? camera.location() : '위치 정보 없음'}">본관 1층</span>
                                    </div>
                                    <span class="camera-list__status camera-list__status--normal">YouTube</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <article class="alert-trend alert-trend--wide" aria-labelledby="trend-title">
                    <h2 id="trend-title">시간대별 알림 추이</h2>
                    <div class="alert-trend__bars" aria-hidden="true">
                        <span style="--height:35%"></span>
                        <span style="--height:42%"></span>
                        <span style="--height:48%"></span>
                        <span style="--height:62%"></span>
                        <span style="--height:70%"></span>
                        <span style="--height:52%"></span>
                        <span style="--height:38%"></span>
                        <span style="--height:30%"></span>
                    </div>
                    <p class="alert-trend__note">알림 데이터 연결 후 자동으로 채워집니다.</p>
                </article>
            </aside>
        </div>
    </div>
</section>
</body>
</html>

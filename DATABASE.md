# Database Schema for SafetyCCTV

This document defines the database schema for the SafetyCCTV project. The schema is based on the Spring Data JPA entities defined in the project.

---

### **Table Relationships**

A simple text representation of the foreign key relationships.

```
[cameras] 1--* [analysis_logs] 1--* [detected_objects]
     |
     `--* [safety_alerts]
```

-   A `cameras` record can have many `analysis_logs` and many `safety_alerts`.
-   An `analysis_logs` record can have many `detected_objects`.

---

### **1. `cameras` Table**

-   **Description**: Stores information and configuration for each registered CCTV camera. The AI server reads this table to get its targets, and the Spring server performs CRUD operations on it.

| Column Name | Data Type | Constraints / Notes |
| --- | --- | --- |
| `id` | `BIGINT` | **Primary Key**, Auto-increment |
| `name` | `VARCHAR(120)` | Not Null. The name of the camera (e.g., "Main Lobby"). |
| `stream_url` | `VARCHAR(255)` | Not Null. The RTSP or YouTube stream URL. |
| `stream_type` | `VARCHAR(16)` | Not Null. Enum: 'RTSP' or 'YOUTUBE'. |
| `location_zone` | `VARCHAR(120)` | Nullable. A descriptive location (e.g., "Engineering Bldg 9th Floor"). |
| `status` | `VARCHAR(16)` | Not Null. Enum: 'HEALTHY', 'WARNING', 'OFFLINE'. |
| `description` | `VARCHAR(255)` | Nullable. Additional description for the camera. |
| `address` | `VARCHAR(255)` | Nullable. Physical address. |
| `latitude` | `DOUBLE` | Nullable. GPS latitude. |
| `longitude` | `DOUBLE` | Nullable. GPS longitude. |
| `created_at` | `TIMESTAMP` | Not Null. Timestamp of record creation. |
| `updated_at` | `TIMESTAMP` | Not Null. Timestamp of the last record update. |

### **2. `analysis_logs` Table**

-   **Description**: A time-series table that stores the results of an AI analysis performed on a camera's frame at a specific point in time.

| Column Name | Data Type | Constraints / Notes |
| --- | --- | --- |
| `id` | `BIGINT` | **Primary Key**, Auto-increment |
| `camera_id` | `BIGINT` | **Foreign Key** to `cameras.id`, Not Null. |
| `timestamp` | `TIMESTAMP` | Not Null. The timestamp when the frame was captured and analyzed. |
| `density` | `DOUBLE` | Not Null. The final calculated density value. |
| `person_count` | `INT` | Not Null. The total number of people detected. |
| `density_velocity` | `DOUBLE` | Nullable. The rate of change of density (velocity). |
| `density_acceleration` | `DOUBLE` | Nullable. The acceleration of density change. |
| `raw_image_path` | `VARCHAR(512)` | Nullable. The storage path of the original captured image. |
| `annotated_image_path` | `VARCHAR(512)` | Nullable. The storage path of the image with bounding boxes drawn. |

### **3. `detected_objects` Table**

-   **Description**: Stores detailed information about each individual object (person) detected within a single analysis frame (`analysis_logs`).

| Column Name | Data Type | Constraints / Notes |
| --- | --- | --- |
| `id` | `BIGINT` | **Primary Key**, Auto-increment |
| `analysis_log_id` | `BIGINT` | **Foreign Key** to `analysis_logs.id`, Not Null. |
| `tracking_id` | `BIGINT` | Nullable. A tracking ID assigned by an algorithm like DeepSORT. |
| `box_x` | `INT` | Not Null. The top-left x-coordinate of the bounding box. |
| `box_y` | `INT` | Not Null. The top-left y-coordinate of the bounding box. |
| `box_width` | `INT` | Not Null. The width of the bounding box. |
| `box_height` | `INT` | Not Null. The height of the bounding box. |
| `confidence` | `DOUBLE` | Nullable. The confidence score of the detection. |

### **4. `safety_alerts` Table**

-   **Description**: Stores a history of safety alerts generated by the system when a specific event (e.g., high congestion, fall detection) is detected.

| Column Name | Data Type | Constraints / Notes |
| --- | --- | --- |
| `id` | `BIGINT` | **Primary Key**, Auto-increment |
| `camera_id` | `BIGINT` | **Foreign Key** to `cameras.id`, Not Null. |
| `timestamp` | `TIMESTAMP` | Not Null. The timestamp when the alert was triggered. |
| `alert_type` | `VARCHAR(32)` | Not Null. The type of alert (e.g., 'CONGESTION_ENTERED'). |
| `alert_level` | `VARCHAR(16)` | Not Null. The severity of the alert (e.g., 'HIGH', 'CRITICAL'). |
| `message` | `VARCHAR(512)` | Not Null. A detailed message describing the alert. |
| `analysis_log_id` | `BIGINT` | Nullable. The ID of the analysis log that triggered this alert. |
| `resolved` | `BOOLEAN` | Not Null, Default `false`. Whether an operator has acknowledged/resolved the alert. |
| `resolved_at` | `TIMESTAMP` | Nullable. The timestamp when the alert was resolved. |
